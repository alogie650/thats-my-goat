<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>That's My GOAT</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');
        :root { --team-color: #39FF14; }
        
        body { 
            background-color: #000; color: #fff; font-family: 'VT323', monospace; 
            font-size: 15px; margin: 0; text-transform: uppercase; letter-spacing: 0.1em;
            overflow-x: hidden;
        }

        .solid-box { background: #000; border: 2px solid #333; position: relative; }
        .dynamic-neon { color: var(--team-color); transition: all 0.4s ease; }
        
        /* The Square Loader */
        #loader {
            position: absolute; width: 12px; height: 12px;
            border: 2px solid var(--team-color);
            right: 15px; top: 50%; transform: translateY(-50%);
            display: none;
        }
        .loading #loader { display: block; animation: square-cycle 0.8s infinite linear; }
        
        @keyframes square-cycle {
            0% { transform: translate(0, -50%) rotate(0deg); }
            100% { transform: translate(0, -50%) rotate(360deg); }
        }

        #player-search { caret-color: transparent; background: transparent; padding-left: 28px !important; }
        #fake-cursor { 
            position: absolute; width: 10px; height: 20px; 
            background-color: var(--team-color); animation: blink 0.6s step-end infinite; 
            pointer-events: none; top: 50%; transform: translateY(-50%); left: 14px; 
        }
        
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
        
        .suggestion-item { border-bottom: 1px solid #111; cursor: pointer; transition: 0.2s; font-size: 1.1rem; }
        .suggestion-item:hover { background: var(--team-color); color: #000; }
        
        .stat-tag { 
            font-size: 1.35rem; border: 2px solid var(--team-color); 
            padding: 5px 15px; margin: 0 10px 10px 0; color: var(--team-color); display: inline-block; 
        }
    </style>
</head>
<body class="min-h-screen p-3 md:p-9" onclick="document.getElementById('player-search').focus()">

    <div class="max-w-5xl mx-auto relative z-10">
        <header class="text-center mb-8">
            <h1 class="text-7xl md:text-9xl font-normal tracking-tighter">THAT'S MY <span class="dynamic-neon">GOAT</span></h1>
        </header>

        <div class="relative max-w-xl mx-auto mb-8">
            <div id="search-box" class="solid-box p-1 flex items-center border-white/20 focus-within:border-[var(--team-color)]">
                <div class="relative flex-1 flex items-center h-[45px]">
                    <input id="player-search" type="text" autocomplete="off" autofocus placeholder="TYPE NAME..."
                           class="w-full bg-transparent text-white outline-none font-bold text-xl uppercase">
                    <div id="fake-cursor"></div>
                    <div id="loader"></div>
                </div>
            </div>
            <div id="suggestions" class="hidden absolute left-0 right-0 mt-1 solid-box z-50 bg-black max-h-[300px] overflow-y-auto"></div>
        </div>

        <div id="result-area" class="hidden">
            <div id="player-card" class="solid-box p-6 md:p-9 border-l-[9px] border-[var(--team-color)]">
                <div class="flex flex-col md:flex-row justify-between items-start mb-8">
                    <div>
                        <h2 id="p-name" class="text-5xl md:text-7xl font-bold dynamic-neon leading-none"></h2>
                        <p id="p-team" class="text-2xl text-white opacity-70 mt-2"></p>
                    </div>
                </div>
                <div id="p-case" class="text-2xl md:text-3xl italic mb-8 border-l-4 border-white/10 pl-4"></div>
                <div id="p-sig" class="flex flex-wrap"></div>
            </div>
        </div>
    </div>

    <span id="text-measurer" style="visibility: hidden; position: absolute; white-space: pre; font-family: 'VT323'; font-size: 20px;"></span>

    <script>
        const API_KEY = "d5bf99e2-09d5-44fd-8e09-d00c9e679c6f";
        const LOCAL_DB = [
            { first_name: "Michael", last_name: "Jordan", team: { full_name: "Chicago Bulls", abbreviation: "CHI" }, rings: 6, blurb: "6-0 FINALS. THE G.O.A.T. STANDARD.", sigs: ["10X SCORING TITLE", "DPOY 1988"] },
            { first_name: "LeBron", last_name: "James", team: { full_name: "L.A. Lakers", abbreviation: "LAL" }, rings: 4, blurb: "ALL-TIME SCORING LEADER. 20+ YEARS OF DOMINANCE.", sigs: ["4X MVP", "40K POINTS"] }
        ];

        let debounceTimer;
        let abortController;
        const input = document.getElementById('player-search');
        const suggestionsDiv = document.getElementById('suggestions');

        // Maintain Focus
        input.addEventListener('blur', () => setTimeout(() => input.focus(), 10));

        input.addEventListener('input', (e) => {
            updateCursor();
            const val = e.target.value.trim().toLowerCase();
            if (val.length < 2) { suggestionsDiv.classList.add('hidden'); return; }
            
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(() => fetchPlayers(val), 150);
        });

        // Search on Enter
        input.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && input.value.trim() !== "") {
                const query = input.value.trim().toLowerCase();
                // Check local first
                const local = LOCAL_DB.find(p => `${p.first_name} ${p.last_name}`.toLowerCase() === query);
                if (local) selectPlayer(local);
                else fetchPlayers(query, true); // Force search
            }
        });

        async function fetchPlayers(query, isFinalSearch = false) {
            if (abortController) abortController.abort();
            abortController = new AbortController();

            document.getElementById('search-box').classList.add('loading');
            
            try {
                const response = await fetch(`https://api.balldontlie.io/nba/v1/players?search=${query}`, {
                    headers: { "Authorization": API_KEY },
                    signal: abortController.signal
                });
                const result = await response.json();
                const players = result.data || [];

                if (isFinalSearch && players.length > 0) {
                    selectPlayer(players[0]);
                } else {
                    renderSuggestions(players, query);
                }
            } catch (err) {
                if (err.name !== 'AbortError') console.error(err);
            } finally {
                document.getElementById('search-box').classList.remove('loading');
            }
        }

        function renderSuggestions(apis, query) {
            suggestionsDiv.innerHTML = '';
            const locals = LOCAL_DB.filter(p => `${p.first_name} ${p.last_name}`.toLowerCase().includes(query));
            const combined = [...locals, ...apis].slice(0, 8);

            if (combined.length === 0) { suggestionsDiv.classList.add('hidden'); return; }

            combined.forEach(p => {
                const div = document.createElement('div');
                div.className = 'suggestion-item p-3 font-bold';
                div.innerHTML = `${p.first_name} ${p.last_name} <span class="opacity-30 ml-2">// ${p.team?.abbreviation || 'NBA'}</span>`;
                div.onclick = () => selectPlayer(p);
                suggestionsDiv.appendChild(div);
            });
            suggestionsDiv.classList.remove('hidden');
        }

        async function selectPlayer(p) {
            suggestionsDiv.classList.add('hidden');
            input.value = "";
            updateCursor();
            
            const color = (p.team?.abbreviation === 'CHI') ? '#CE1141' : (p.team?.abbreviation === 'LAL' ? '#FDB927' : '#39FF14');
            document.documentElement.style.setProperty('--team-color', color);
            document.getElementById('result-area').classList.remove('hidden');
            
            document.getElementById('p-sig').innerHTML = '';
            (p.sigs || ["NBA ACTIVE", "VERIFIED DATA"]).forEach(s => {
                document.getElementById('p-sig').innerHTML += `<span class="stat-tag">${s}</span>`;
            });

            typeWriter(`${p.first_name} ${p.last_name}`, 'p-name', 15);
            typeWriter(p.team?.full_name || "Free Agent", 'p-team', 10);
            typeWriter(p.blurb || `FETCHING LIVE INTEL ON ${p.first_name}... STATUS: ACTIVE ${p.position || 'PLAYER'}.`, 'p-case', 5);
        }

        function updateCursor() {
            const measurer = document.getElementById('text-measurer');
            measurer.textContent = input.value;
            document.getElementById('fake-cursor').style.left = (14 + measurer.offsetWidth) + "px";
        }

        async function typeWriter(text, id, speed) {
            const el = document.getElementById(id);
            el.innerText = "";
            for (const char of text) {
                el.innerText += char;
                await new Promise(r => setTimeout(r, speed));
            }
        }
    </script>
</body>
</html>
